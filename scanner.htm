<!DOCTYPE html>
<html>
<head>
  <title>Barcode Scanner</title>
  <script src="https://unpkg.com/@zxing/library@latest"></script>
</head>
<body>
  <h1>Barcode Scanner</h1>

  <button onclick="scanPython()">Scan with Python (OpenCV)</button>
  <p id="python-result"></p>

  <h2>Or scan with browser webcam (JS)</h2>
  <video id="video" width="400" height="300" style="border:1px solid black;"></video>
  <p id="js-result"></p>

  <script>
    async function scanPython() {
      document.getElementById("python-result").innerText = "Scanning with Python...";
      const res = await fetch("http://127.0.0.1:5000/scan-py");
      const data = await res.json();
      document.getElementById("python-result").innerText =
        `Produkt: ${data.name} | Holdbarhet: ${data.expiration_date}`;
    }

    // JS Barcode scanning (ZXing)
    const codeReader = new ZXing.BrowserMultiFormatReader();
    const videoElement = document.getElementById('video');

    codeReader.decodeFromVideoDevice(null, videoElement, async (result, err) => {
      if (result) {
        const barcode = result.text;
        document.getElementById("js-result").innerText = "Barcode: " + barcode;

        // Ask Python backend to look it up
        const res = await fetch(`http://127.0.0.1:5000/lookup/${barcode}`);
        const data = await res.json();
        document.getElementById("js-result").innerText =
          `Produkt: ${data.name} | Holdbarhet: ${data.expiration_date}`;
      }
    });
  </script>
</body>
</html>
