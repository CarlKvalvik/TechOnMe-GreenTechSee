<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Barcode Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://unpkg.com/@zxing/library@latest"></script>
  <link rel="stylesheet" href="scannerstyle.css">
</head>
<body>
  <main>
    <h1>Barcode Scanner</h1>

    <button class="scan-btn" onclick="scanPython()">Scan with Python (OpenCV)</button>
    <p id="python-result"></p>

    <h2>Or scan with browser webcam (JS)</h2>
    <video id="video" width="400" height="300"></video>
    <p id="js-result"></p>
  </main>

  <!-- Mobile Navbar -->
  <nav class="mobile-nav">
    <a href="#" class="bloc-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M304 70.1C313.1 61.9 326.9 61.9 336 70.1L568 278.1C577.9 286.9 578.7 302.1 569.8 312C560.9 321.9 545.8 322.7 535.9 313.8L527.9 306.6L527.9 511.9C527.9 547.2 499.2 575.9 463.9 575.9L175.9 575.9C140.6 575.9 111.9 547.2 111.9 511.9L111.9 306.6L103.9 313.8C94 322.6 78.9 321.8 70 312C61.1 302.2 62 287 71.8 278.1L304 70.1zM320 120.2L160 263.7L160 512C160 520.8 167.2 528 176 528L224 528L224 424C224 384.2 256.2 352 296 352L344 352C383.8 352 416 384.2 416 424L416 528L464 528C472.8 528 480 520.8 480 512L480 263.7L320 120.3zM272 528L368 528L368 424C368 410.7 357.3 400 344 400L296 400C282.7 400 272 410.7 272 424L272 528z"/></svg>
    </a>
    <a href="scanner.htm" class="bloc-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M257.1 96C238.4 96 220.9 105.4 210.5 120.9L184.5 160L128 160C92.7 160 64 188.7 64 224L64 480C64 515.3 92.7 544 128 544L512 544C547.3 544 576 515.3 576 480L576 224C576 188.7 547.3 160 512 160L455.5 160L429.5 120.9C419.1 105.4 401.6 96 382.9 96L257.1 96zM250.4 147.6C251.9 145.4 254.4 144 257.1 144L382.8 144C385.5 144 388 145.3 389.5 147.6L422.7 197.4C427.2 204.1 434.6 208.1 442.7 208.1L512 208.1C520.8 208.1 528 215.3 528 224.1L528 480.1C528 488.9 520.8 496.1 512 496.1L128 496C119.2 496 112 488.8 112 480L112 224C112 215.2 119.2 208 128 208L197.3 208C205.3 208 212.8 204 217.3 197.3L250.5 147.5zM320 448C381.9 448 432 397.9 432 336C432 274.1 381.9 224 320 224C258.1 224 208 274.1 208 336C208 397.9 258.1 448 320 448zM256 336C256 300.7 284.7 272 320 272C355.3 272 384 300.7 384 336C384 371.3 355.3 400 320 400C284.7 400 256 371.3 256 336z"/></svg>
    </a>
    <a href="#" class="bloc-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M104 112C90.7 112 80 122.7 80 136L80 184C80 197.3 90.7 208 104 208L152 208C165.3 208 176 197.3 176 184L176 136C176 122.7 165.3 112 152 112L104 112zM256 128C238.3 128 224 142.3 224 160C224 177.7 238.3 192 256 192L544 192C561.7 192 576 177.7 576 160C576 142.3 561.7 128 544 128L256 128zM256 288C238.3 288 224 302.3 224 320C224 337.7 238.3 352 256 352L544 352C561.7 352 576 337.7 576 320C576 302.3 561.7 288 544 288L256 288zM256 448C238.3 448 224 462.3 224 480C224 497.7 238.3 512 256 512L544 512C561.7 512 576 497.7 576 480C576 462.3 561.7 448 544 448L256 448zM80 296L80 344C80 357.3 90.7 368 104 368L152 368C165.3 368 176 357.3 176 344L176 296C176 282.7 165.3 272 152 272L104 272C90.7 272 80 282.7 80 296zM104 432C90.7 432 80 442.7 80 456L80 504C80 517.3 90.7 528 104 528L152 528C165.3 528 176 517.3 176 504L176 456C176 442.7 165.3 432 152 432L104 432z"/></svg>
    </a>
    <a href="#" class="bloc-icon" id="loginBtnMobile">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M240 192C240 147.8 275.8 112 320 112C364.2 112 400 147.8 400 192C400 236.2 364.2 272 320 272C275.8 272 240 236.2 240 192zM448 192C448 121.3 390.7 64 320 64C249.3 64 192 121.3 192 192C192 262.7 249.3 320 320 320C390.7 320 448 262.7 448 192zM144 544C144 473.3 201.3 416 272 416L368 416C438.7 416 496 473.3 496 544L496 552C496 565.3 506.7 576 520 576C533.3 576 544 565.3 544 552L544 544C544 446.8 465.2 368 368 368L272 368C174.8 368 96 446.8 96 544L96 552C96 565.3 106.7 576 120 576C133.3 576 144 565.3 144 552L144 544z"/></svg>
    </a>
  </nav>

  <!-- Login Modal -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <h2>Login</h2>
      <form id="loginForm">
        <input type="text" id="username" placeholder="Username" required>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit" class="submit-btn">Submit</button>
        <div class="error-msg" id="errorMsg"></div>
      </form>
      <button class="close-btn" id="closeModal">Close</button>
    </div>
  </div>

  <!-- Success Modal -->
  <div class="success-modal" id="successModal">
    <div class="success-box">âœ… Login Successful!</div>
  </div>

  <script>
    async function scanPython() {
      document.getElementById("python-result").innerText = "Scanning with Python...";
      const res = await fetch("http://127.0.0.1:5000/scan-py");
      const data = await res.json();
      document.getElementById("python-result").innerText =
        `Produkt: ${data.name} | Holdbarhet: ${data.expiration_date}`;
    }

    // JS Barcode scanning (ZXing)
    const codeReader = new ZXing.BrowserMultiFormatReader();
    const videoElement = document.getElementById('video');

    codeReader.decodeFromVideoDevice(null, videoElement, async (result, err) => {
      if (result) {
        const barcode = result.text;
        document.getElementById("js-result").innerText = "Barcode: " + barcode;

        const res = await fetch(`http://127.0.0.1:5000/lookup/${barcode}`);
        const data = await res.json();
        document.getElementById("js-result").innerText =
          `Produkt: ${data.name} | Holdbarhet: ${data.expiration_date}`;
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      const loginBtnMobile = document.getElementById('loginBtnMobile');
      const modal = document.getElementById('loginModal');
      const closeModal = document.getElementById('closeModal');
      const loginForm = document.getElementById('loginForm');
      const successModal = document.getElementById('successModal');
      const errorMsg = document.getElementById('errorMsg');

      loginBtnMobile.addEventListener('click', (e) => {
        e.preventDefault();
        modal.style.display = 'flex';
      });

      closeModal.addEventListener('click', () => {
        modal.style.display = 'none';
      });

      window.addEventListener('click', (e) => {
        if (e.target === modal) modal.style.display = 'none';
      });

      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        if(username === "TechOnMe" && password === "123") {
          modal.style.display = 'none';
          errorMsg.textContent = '';
          successModal.style.display = 'flex';
          setTimeout(() => successModal.style.display = 'none', 1000);
        } else {
          errorMsg.textContent = "Invalid username or password!";
        }
      });
    });
  </script>
</body>
</html>
